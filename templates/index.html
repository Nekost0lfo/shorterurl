<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–µ—Ä–≤–∏—Å —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ –°–æ–∫—Ä–∞—â–∞—Ç–µ–ª—å —Å—Å—ã–ª–æ–∫</h1>
            <p>–°–¥–µ–ª–∞–π—Ç–µ –≤–∞—à–∏ –¥–ª–∏–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –∫–æ—Ä–æ—Ç–∫–∏–º–∏ –∏ —É–¥–æ–±–Ω—ã–º–∏!</p>
        </header>

        <main>
            <div class="shortener-form">
                <input type="url" id="urlInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω–Ω—É—é —Å—Å—ã–ª–∫—É..." required>
                <button onclick="shortenUrl()">–°–æ–∫—Ä–∞—Ç–∏—Ç—å</button>
            </div>

            <div id="result" class="result hidden">
                <h3>–í–∞—à–∞ –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞:</h3>
                <div class="short-url">
                    <a id="shortLink" href="" target="_blank"></a>
                    <button onclick="copyToClipboard()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                <div class="stats-link">
                    <a id="statsLink" href="">üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</a>
                </div>
            </div>

            <div id="error" class="error hidden">
                <p id="errorMessage"></p>
            </div>
        </main>

        <footer>
            <p>–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã –ø–æ DevOps</p>
        </footer>
    </div>

    <script>
        async function shortenUrl() {
            const urlInput = document.getElementById('urlInput');
            const resultDiv = document.getElementById('result');
            const errorDiv = document.getElementById('error');
            const url = urlInput.value.trim();

            if (!url) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É');
                return;
            }

            try {
                const response = await fetch('/shorten', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });

                const data = await response.json();

                if (response.ok) {
                    hideError();
                    displayResult(data);
                } else {
                    showError(data.error || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞');
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
            }
        }

        function displayResult(data) {
            const resultDiv = document.getElementById('result');
            const shortLink = document.getElementById('shortLink');
            const statsLink = document.getElementById('statsLink');

            shortLink.href = data.short_url;
            shortLink.textContent = data.short_url;
            
            statsLink.href = `/stats/${data.short_code}`;
            
            resultDiv.classList.remove('hidden');
        }

        function copyToClipboard() {
            const shortLink = document.getElementById('shortLink');
            navigator.clipboard.writeText(shortLink.href)
                .then(() => {
                    alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                })
                .catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
                });
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            const errorMessage = document.getElementById('errorMessage');
            const resultDiv = document.getElementById('result');
            
            errorMessage.textContent = message;
            errorDiv.classList.remove('hidden');
            resultDiv.classList.add('hidden');
        }

        function hideError() {
            const errorDiv = document.getElementById('error');
            errorDiv.classList.add('hidden');
        }

        // Enter key support
        document.getElementById('urlInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                shortenUrl();
            }
        });
    </script>
</body>
</html>